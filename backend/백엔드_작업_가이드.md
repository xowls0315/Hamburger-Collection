# ë°±ì—”ë“œ(Nest.js) ì‘ì—… ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” í–„ë²„ê±° ëª¨ìŒ ì‚¬ì´íŠ¸ì˜ ë°±ì—”ë“œ ê°œë°œì„ ìœ„í•œ ìƒì„¸í•œ ì‘ì—… ê³¼ì •ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [í™˜ê²½ ì„¤ì •](#1-í™˜ê²½-ì„¤ì •)
   - [1-1. DBeaverë¥¼ ì‚¬ìš©í•œ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •](#1-1-dbeaverë¥¼-ì‚¬ìš©í•œ-postgresql-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ì •)
2. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„](#2-ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ-ì„¤ê³„)
3. [TypeORM ì„¤ì •](#3-typeorm-ì„¤ì •)
4. [ëª¨ë“ˆ êµ¬ì¡° ì„¤ê³„](#4-ëª¨ë“ˆ-êµ¬ì¡°-ì„¤ê³„)
5. [ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ (JWT + RefreshToken)](#5-ì¸ì¦-ì‹œìŠ¤í…œ-êµ¬í˜„-jwt--refreshtoken)
6. [API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„](#6-api-ì—”ë“œí¬ì¸íŠ¸-êµ¬í˜„)
7. [ì¹´ì¹´ì˜¤ OAuth ì—°ë™](#7-ì¹´ì¹´ì˜¤-oauth-ì—°ë™)
8. [ì¹´ì¹´ì˜¤ ë¡œì»¬ API ì—°ë™](#8-ì¹´ì¹´ì˜¤-ë¡œì»¬-api-ì—°ë™)
9. [CORS ë° ë³´ì•ˆ ì„¤ì •](#9-cors-ë°-ë³´ì•ˆ-ì„¤ì •)
10. [Render ë°°í¬ ì¤€ë¹„](#10-render-ë°°í¬-ì¤€ë¹„)
11. [í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì¡°](#11-í”„ë¡œì íŠ¸-íŒŒì¼-êµ¬ì¡°)

---

## 1. í™˜ê²½ ì„¤ì •

### 1.1 í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •

ë¨¼ì € `INSTALL.md` íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì„¤ì •í•˜ì„¸ìš”.

### 1.2 í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
cd backend
npm install
```

ë˜ëŠ” ê°œë³„ ì„¤ì¹˜:

```bash
cd backend
npm install @nestjs/typeorm typeorm pg
npm install @nestjs/config
npm install @nestjs/jwt @nestjs/passport passport passport-jwt
npm install class-validator class-transformer
npm install cookie-parser
npm install axios
npm install bcrypt
npm install --save-dev @types/passport-jwt @types/bcrypt @types/cookie-parser
```

### 1.3 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:

```env
# ë°ì´í„°ë² ì´ìŠ¤
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=your_password
DATABASE_NAME=hamburger_collection

# JWT
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production-min-32-characters
JWT_ACCESS_TOKEN_EXPIRATION=15m
JWT_REFRESH_TOKEN_EXPIRATION=7d

# ì¹´ì¹´ì˜¤ OAuth
KAKAO_REST_API_KEY=your_kakao_rest_api_key
KAKAO_REDIRECT_URI=http://localhost:3001/auth/kakao/callback
KAKAO_CLIENT_SECRET=your_kakao_client_secret

# ì¹´ì¹´ì˜¤ ë¡œì»¬ API
KAKAO_LOCAL_API_KEY=your_kakao_local_api_key

# ì„œë²„
PORT=3001
NODE_ENV=development

# í”„ë¡ íŠ¸ì—”ë“œ URL (CORSìš©)
FRONTEND_URL=http://localhost:3000
```

> ğŸ’¡ **ì°¸ê³ **: `.env.example` íŒŒì¼ì„ ì°¸ê³ í•˜ê±°ë‚˜ `INSTALL.md`ë¥¼ í™•ì¸í•˜ì„¸ìš”.

---

## 1-1. DBeaverë¥¼ ì‚¬ìš©í•œ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

### 1-1.1 DBeaver ì—°ê²° ì„¤ì •

1. **DBeaver ì‹¤í–‰**
2. **ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒì„±**
   - ìƒë‹¨ ë©”ë‰´: `ë°ì´í„°ë² ì´ìŠ¤` â†’ `ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°`
   - ë˜ëŠ” `Ctrl+Shift+D`
3. **PostgreSQL ì„ íƒ**
4. **ì—°ê²° ì •ë³´ ì…ë ¥**:
   - í˜¸ìŠ¤íŠ¸: `localhost`
   - í¬íŠ¸: `5432`
   - ë°ì´í„°ë² ì´ìŠ¤: `postgres` (ê¸°ë³¸ ë°ì´í„°ë² ì´ìŠ¤)
   - ì‚¬ìš©ìëª…: `postgres`
   - ë¹„ë°€ë²ˆí˜¸: PostgreSQL ì„¤ì¹˜ ì‹œ ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸
5. **í…ŒìŠ¤íŠ¸ ì—°ê²°** í´ë¦­í•˜ì—¬ ì—°ê²° í™•ì¸
6. **ì™„ë£Œ** í´ë¦­

### 1-1.2 ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±

DBeaverì—ì„œ SQL í¸ì§‘ê¸°ë¥¼ ì—´ê³  ë‹¤ìŒ SQLì„ ì‹¤í–‰í•˜ì„¸ìš”:

**ë°©ë²• 1: SQL í¸ì§‘ê¸° ì‚¬ìš©**

1. ì—°ê²°ëœ ë°ì´í„°ë² ì´ìŠ¤ ìš°í´ë¦­ â†’ `SQL í¸ì§‘ê¸°` â†’ `ìƒˆ SQL ìŠ¤í¬ë¦½íŠ¸`
2. ë˜ëŠ” `Ctrl+\` ë‹¨ì¶•í‚¤ ì‚¬ìš©
3. ë‹¤ìŒ SQL ì…ë ¥:

```sql
-- ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
CREATE DATABASE hamburger_collection;

-- ìƒì„± í™•ì¸
\l
```

**ë°©ë²• 2: GUI ì‚¬ìš©**

1. ì—°ê²°ëœ ë°ì´í„°ë² ì´ìŠ¤ ìš°í´ë¦­ â†’ `ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±`
2. ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„: `hamburger_collection`
3. ìƒì„± í´ë¦­

### 1-1.3 í…Œì´ë¸” ìƒì„± ë° ì´ˆê¸°í™”

1. **ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°**
   - `hamburger_collection` ë°ì´í„°ë² ì´ìŠ¤ ìš°í´ë¦­ â†’ `ìƒˆ ì—°ê²°`
   - ë˜ëŠ” ê¸°ì¡´ ì—°ê²°ì˜ ë°ì´í„°ë² ì´ìŠ¤ë§Œ ë³€ê²½

2. **SQL ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰**
   - `database/init.sql` íŒŒì¼ ì—´ê¸°
   - ë˜ëŠ” SQL í¸ì§‘ê¸°ì— íŒŒì¼ ë‚´ìš© ë³µì‚¬
   - ì „ì²´ ì‹¤í–‰: `Ctrl+Alt+X` ë˜ëŠ” ì‹¤í–‰ ë²„íŠ¼ í´ë¦­

3. **ì‹¤í–‰ ê²°ê³¼ í™•ì¸**
   - í•˜ë‹¨ ê²°ê³¼ íƒ­ì—ì„œ ì„±ê³µ ë©”ì‹œì§€ í™•ì¸
   - í…Œì´ë¸” ëª©ë¡ í™•ì¸: ë°ì´í„°ë² ì´ìŠ¤ â†’ ìŠ¤í‚¤ë§ˆ â†’ public â†’ í…Œì´ë¸”

### 1-1.4 ë°ì´í„° í™•ì¸

```sql
-- ë¸Œëœë“œ ë°ì´í„° í™•ì¸
SELECT * FROM brands;

-- í…Œì´ë¸” ëª©ë¡ í™•ì¸
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;

-- íŠ¹ì • í…Œì´ë¸” êµ¬ì¡° í™•ì¸
\d brands
```

### 1-1.5 DBeaver SQL í¸ì§‘ê¸° ë‹¨ì¶•í‚¤

- `Ctrl+Enter`: ì„ íƒí•œ ì¿¼ë¦¬ ì‹¤í–‰
- `Ctrl+Alt+X`: ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
- `Ctrl+\`: ìƒˆ SQL í¸ì§‘ê¸° ì—´ê¸°
- `Ctrl+Shift+F`: SQL í¬ë§·íŒ…
- `F5`: ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš ë³´ê¸°

### 1-1.6 ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” SQL ìŠ¤í¬ë¦½íŠ¸ ìƒì„¸ ì„¤ëª…

**íŒŒì¼ ìœ„ì¹˜**: `database/init.sql`

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:

1. **UUID í™•ì¥ ê¸°ëŠ¥ í™œì„±í™”**

   ```sql
   CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
   ```

   - UUID ìë™ ìƒì„±ì— í•„ìš”

2. **í…Œì´ë¸” ìƒì„±**
   - `brands`: ë¸Œëœë“œ ì •ë³´
   - `users`: ì‚¬ìš©ì ì •ë³´ (ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸)
   - `menu_items`: ë©”ë‰´ ì•„ì´í…œ
   - `nutrition`: ì˜ì–‘ì •ë³´
   - `posts`: ê²Œì‹œê¸€
   - `comments`: ëŒ“ê¸€
   - `ingest_logs`: ìˆ˜ì§‘ ë¡œê·¸ (ì˜µì…˜)

3. **ì¸ë±ìŠ¤ ìƒì„±**
   - ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ì¸ë±ìŠ¤
   - `brand_id`, `category`, `user_id`, `post_id` ë“±

4. **íŠ¸ë¦¬ê±° ìƒì„±**
   - `updated_at` ì»¬ëŸ¼ ìë™ ì—…ë°ì´íŠ¸

5. **ì‹œë“œ ë°ì´í„° ì‚½ì…**
   - 7ê°œ ë¸Œëœë“œ ê¸°ë³¸ ë°ì´í„°

**ì‹¤í–‰ ë°©ë²•:**

```sql
-- DBeaver SQL í¸ì§‘ê¸°ì—ì„œ
-- 1. database/init.sql íŒŒì¼ ì—´ê¸°
-- 2. ì „ì²´ ì„ íƒ (Ctrl+A)
-- 3. ì‹¤í–‰ (Ctrl+Alt+X)
```

**ì‹¤í–‰ í›„ í™•ì¸:**

```sql
-- í…Œì´ë¸” ëª©ë¡ í™•ì¸
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
ORDER BY table_name;

-- ë¸Œëœë“œ ë°ì´í„° í™•ì¸
SELECT * FROM brands;

-- ê° í…Œì´ë¸”ì˜ ë ˆì½”ë“œ ìˆ˜ í™•ì¸
SELECT
    'brands' as table_name, COUNT(*) as count FROM brands
UNION ALL
SELECT 'users', COUNT(*) FROM users
UNION ALL
SELECT 'menu_items', COUNT(*) FROM menu_items
UNION ALL
SELECT 'nutrition', COUNT(*) FROM nutrition
UNION ALL
SELECT 'posts', COUNT(*) FROM posts
UNION ALL
SELECT 'comments', COUNT(*) FROM comments;
```

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### 2.0 ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” (DBeaver ì‚¬ìš©)

**ì¤‘ìš”**: TypeORMì˜ `synchronize: true`ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš°, ë¨¼ì € SQL ìŠ¤í¬ë¦½íŠ¸ë¡œ í…Œì´ë¸”ì„ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤.

1. **DBeaverì—ì„œ `hamburger_collection` ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°**
2. **SQL í¸ì§‘ê¸° ì—´ê¸°** (`Ctrl+\`)
3. **`database/init.sql` íŒŒì¼ ì‹¤í–‰**
   - íŒŒì¼ ì—´ê¸°: `íŒŒì¼` â†’ `ì—´ê¸°` â†’ `database/init.sql`
   - ë˜ëŠ” ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ SQL í¸ì§‘ê¸°ì— ë¶™ì—¬ë„£ê¸°
   - ì‹¤í–‰: `Ctrl+Alt+X` ë˜ëŠ” ì‹¤í–‰ ë²„íŠ¼ í´ë¦­

**ì´ˆê¸°í™” SQL ìŠ¤í¬ë¦½íŠ¸ ë‚´ìš©:**

- ëª¨ë“  í…Œì´ë¸” ìƒì„± (brands, users, menu_items, nutrition, posts, comments, ingest_logs)
- ì¸ë±ìŠ¤ ìƒì„±
- íŠ¸ë¦¬ê±° ìƒì„± (updated_at ìë™ ì—…ë°ì´íŠ¸)
- ì‹œë“œ ë°ì´í„° ì‚½ì… (7ê°œ ë¸Œëœë“œ)

### 2.1 Entity ìƒì„± ìˆœì„œ

ë‹¤ìŒ ìˆœì„œë¡œ Entityë¥¼ ìƒì„±í•©ë‹ˆë‹¤:

1. **User** (ì‚¬ìš©ì)
2. **Brand** (ë¸Œëœë“œ)
3. **MenuItem** (ë©”ë‰´ ì•„ì´í…œ)
4. **Nutrition** (ì˜ì–‘ì •ë³´)
5. **Post** (ê²Œì‹œê¸€)
6. **Comment** (ëŒ“ê¸€)
7. **IngestLog** (ìˆ˜ì§‘ ë¡œê·¸) - ì˜µì…˜

### 2.2 User Entity

**íŒŒì¼**: `src/users/entities/user.entity.ts`

```typescript
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  UpdateDateColumn,
  OneToMany,
} from 'typeorm';
import { Post } from '../../posts/entities/post.entity';
import { Comment } from '../../comments/entities/comment.entity';

@Entity('users')
export class User {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column({ unique: true })
  kakaoId: string;

  @Column()
  nickname: string;

  @Column({ nullable: true })
  profileImage: string;

  @Column({ default: 'user' })
  role: string; // 'user' | 'admin'

  @OneToMany(() => Post, (post) => post.user)
  posts: Post[];

  @OneToMany(() => Comment, (comment) => comment.user)
  comments: Comment[];

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}
```

### 2.3 Brand Entity

**íŒŒì¼**: `src/brands/entities/brand.entity.ts`

```typescript
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  UpdateDateColumn,
  OneToMany,
} from 'typeorm';
import { MenuItem } from '../../menu-items/entities/menu-item.entity';

@Entity('brands')
export class Brand {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column({ unique: true })
  slug: string; // 'mcdonalds', 'burgerking', etc.

  @Column()
  name: string; // 'ë§¥ë„ë‚ ë“œ', 'ë²„ê±°í‚¹', etc.

  @Column({ nullable: true })
  logoUrl: string;

  @OneToMany(() => MenuItem, (menuItem) => menuItem.brand)
  menuItems: MenuItem[];

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}
```

### 2.4 MenuItem Entity

**íŒŒì¼**: `src/menu-items/entities/menu-item.entity.ts`

```typescript
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  UpdateDateColumn,
  ManyToOne,
  OneToOne,
  JoinColumn,
} from 'typeorm';
import { Brand } from '../../brands/entities/brand.entity';
import { Nutrition } from '../../nutrition/entities/nutrition.entity';

@Entity('menu_items')
export class MenuItem {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @ManyToOne(() => Brand, (brand) => brand.menuItems)
  brand: Brand;

  @Column()
  brandId: string;

  @Column()
  name: string;

  @Column()
  category: string; // 'burger', 'chicken', 'side', 'drink'

  @Column({ nullable: true })
  imageUrl: string;

  @Column({ nullable: true })
  detailUrl: string; // ì›ë³¸ ì‚¬ì´íŠ¸ ë§í¬

  @Column({ default: true })
  isActive: boolean;

  @OneToOne(() => Nutrition, (nutrition) => nutrition.menuItem, {
    cascade: true,
  })
  @JoinColumn()
  nutrition: Nutrition;

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}
```

### 2.5 Nutrition Entity

**íŒŒì¼**: `src/nutrition/entities/nutrition.entity.ts`

```typescript
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  OneToOne,
  JoinColumn,
} from 'typeorm';
import { MenuItem } from '../../menu-items/entities/menu-item.entity';

@Entity('nutrition')
export class Nutrition {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @OneToOne(() => MenuItem, (menuItem) => menuItem.nutrition)
  @JoinColumn()
  menuItem: MenuItem;

  @Column()
  menuItemId: string;

  @Column({ type: 'int', nullable: true })
  kcal: number;

  @Column({ type: 'decimal', precision: 10, scale: 2, nullable: true })
  carbohydrate: number;

  @Column({ type: 'decimal', precision: 10, scale: 2, nullable: true })
  protein: number;

  @Column({ type: 'decimal', precision: 10, scale: 2, nullable: true })
  fat: number;

  @Column({ type: 'int', nullable: true })
  sodium: number; // mg

  @Column({ type: 'decimal', precision: 10, scale: 2, nullable: true })
  sugar: number;
}
```

### 2.6 Post Entity

**íŒŒì¼**: `src/posts/entities/post.entity.ts`

```typescript
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  UpdateDateColumn,
  ManyToOne,
  OneToMany,
  JoinColumn,
} from 'typeorm';
import { User } from '../../users/entities/user.entity';
import { Comment } from '../../comments/entities/comment.entity';

@Entity('posts')
export class Post {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @ManyToOne(() => User, (user) => user.posts)
  @JoinColumn({ name: 'userId' })
  user: User;

  @Column()
  userId: string;

  @Column()
  title: string;

  @Column('text')
  content: string;

  @Column({ default: 0 })
  viewCount: number;

  @OneToMany(() => Comment, (comment) => comment.post, { cascade: true })
  comments: Comment[];

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}
```

### 2.7 Comment Entity

**íŒŒì¼**: `src/comments/entities/comment.entity.ts`

```typescript
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  UpdateDateColumn,
  ManyToOne,
  JoinColumn,
} from 'typeorm';
import { Post } from '../../posts/entities/post.entity';
import { User } from '../../users/entities/user.entity';

@Entity('comments')
export class Comment {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @ManyToOne(() => Post, (post) => post.comments, { onDelete: 'CASCADE' })
  @JoinColumn({ name: 'postId' })
  post: Post;

  @Column()
  postId: string;

  @ManyToOne(() => User, (user) => user.comments)
  @JoinColumn({ name: 'userId' })
  user: User;

  @Column()
  userId: string;

  @Column('text')
  content: string;

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}
```

### 2.8 IngestLog Entity (ì˜µì…˜)

**íŒŒì¼**: `src/admin/entities/ingest-log.entity.ts`

```typescript
import {
  Entity,
  PrimaryGeneratedColumn,
  Column,
  CreateDateColumn,
  ManyToOne,
  JoinColumn,
} from 'typeorm';
import { Brand } from '../../brands/entities/brand.entity';

@Entity('ingest_logs')
export class IngestLog {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @ManyToOne(() => Brand)
  @JoinColumn({ name: 'brandId' })
  brand: Brand;

  @Column()
  brandId: string;

  @Column()
  status: string; // 'success' | 'error'

  @Column({ type: 'int', default: 0 })
  changedCount: number;

  @Column('text', { nullable: true })
  error: string;

  @CreateDateColumn()
  fetchedAt: Date;
}
```

---

## 3. TypeORM ì„¤ì •

### 3.1 AppModuleì— TypeORM ì„¤ì •

**íŒŒì¼**: `src/app.module.ts`

```typescript
import { Module } from '@nestjs/common';
import { ConfigModule, ConfigService } from '@nestjs/config';
import { TypeOrmModule } from '@nestjs/typeorm';
import { AppController } from './app.controller';
import { AppService } from './app.service';
import { UsersModule } from './users/users.module';
import { BrandsModule } from './brands/brands.module';
import { MenuItemsModule } from './menu-items/menu-items.module';
import { NutritionModule } from './nutrition/nutrition.module';
import { PostsModule } from './posts/posts.module';
import { CommentsModule } from './comments/comments.module';
import { AuthModule } from './auth/auth.module';
import { StoresModule } from './stores/stores.module';
import { AdminModule } from './admin/admin.module';

@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
      envFilePath: '.env',
    }),
    TypeOrmModule.forRootAsync({
      imports: [ConfigModule],
      useFactory: (configService: ConfigService) => ({
        type: 'postgres',
        host: configService.get('DATABASE_HOST'),
        port: configService.get('DATABASE_PORT'),
        username: configService.get('DATABASE_USERNAME'),
        password: configService.get('DATABASE_PASSWORD'),
        database: configService.get('DATABASE_NAME'),
        entities: [__dirname + '/**/*.entity{.ts,.js}'],
        synchronize: configService.get('NODE_ENV') === 'development', // ê°œë°œ í™˜ê²½ì—ì„œë§Œ true
        logging: configService.get('NODE_ENV') === 'development',
      }),
      inject: [ConfigService],
    }),
    UsersModule,
    BrandsModule,
    MenuItemsModule,
    NutritionModule,
    PostsModule,
    CommentsModule,
    AuthModule,
    StoresModule,
    AdminModule,
  ],
  controllers: [AppController],
  providers: [AppService],
})
export class AppModule {}
```

---

## 4. ëª¨ë“ˆ êµ¬ì¡° ì„¤ê³„

### 4.1 ëª¨ë“ˆ ìƒì„± ìˆœì„œ

ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ëª¨ë“ˆì„ ìƒì„±í•©ë‹ˆë‹¤:

```bash
# ëª¨ë“ˆ ìƒì„±
nest g module users
nest g module brands
nest g module menu-items
nest g module nutrition
nest g module posts
nest g module comments
nest g module auth
nest g module stores
nest g module admin

# Entity ìƒì„±
nest g class users/entities/user.entity --no-spec
nest g class brands/entities/brand.entity --no-spec
nest g class menu-items/entities/menu-item.entity --no-spec
nest g class nutrition/entities/nutrition.entity --no-spec
nest g class posts/entities/post.entity --no-spec
nest g class comments/entities/comment.entity --no-spec
nest g class admin/entities/ingest-log.entity --no-spec

# Service ë° Controller ìƒì„±
nest g service users
nest g controller users
nest g service brands
nest g controller brands
nest g service menu-items
nest g controller menu-items
nest g service nutrition
nest g service posts
nest g controller posts
nest g service comments
nest g controller comments
nest g service auth
nest g controller auth
nest g service stores
nest g controller stores
nest g service admin
nest g controller admin
```

### 4.2 ëª¨ë“ˆë³„ ì—­í• 

- **UsersModule**: ì‚¬ìš©ì ê´€ë¦¬
- **BrandsModule**: ë¸Œëœë“œ ì •ë³´ ê´€ë¦¬
- **MenuItemsModule**: ë©”ë‰´ ì•„ì´í…œ CRUD
- **NutritionModule**: ì˜ì–‘ì •ë³´ ê´€ë¦¬
- **PostsModule**: ê²Œì‹œê¸€ CRUD
- **CommentsModule**: ëŒ“ê¸€ CRUD
- **AuthModule**: ì¸ì¦/ì¸ê°€ (ì¹´ì¹´ì˜¤ OAuth, JWT)
- **StoresModule**: ë§¤ì¥ ê²€ìƒ‰ (ì¹´ì¹´ì˜¤ ë¡œì»¬ API)
- **AdminModule**: ê´€ë¦¬ì ê¸°ëŠ¥ (ìˆ˜ì§‘ ì‹¤í–‰ ë“±)

---

## 5. ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ (JWT + RefreshToken)

### 5.1 JWT Strategy ì„¤ì •

**íŒŒì¼**: `src/auth/strategies/jwt.strategy.ts`

```typescript
import { Injectable, UnauthorizedException } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { ExtractJwt, Strategy } from 'passport-jwt';
import { ConfigService } from '@nestjs/config';
import { UsersService } from '../../users/users.service';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor(
    private configService: ConfigService,
    private usersService: UsersService,
  ) {
    super({
      jwtFromRequest: ExtractJwt.fromExtractors([
        (request) => {
          return request?.cookies?.accessToken;
        },
      ]),
      ignoreExpiration: false,
      secretOrKey: configService.get('JWT_SECRET'),
    });
  }

  async validate(payload: any) {
    const user = await this.usersService.findOne(payload.sub);
    if (!user) {
      throw new UnauthorizedException();
    }
    return user;
  }
}
```

### 5.2 RefreshToken Strategy (ì˜µì…˜)

**íŒŒì¼**: `src/auth/strategies/jwt-refresh.strategy.ts`

```typescript
import { Injectable } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { ExtractJwt, Strategy } from 'passport-jwt';
import { ConfigService } from '@nestjs/config';
import { UsersService } from '../../users/users.service';

@Injectable()
export class JwtRefreshStrategy extends PassportStrategy(
  Strategy,
  'jwt-refresh',
) {
  constructor(
    private configService: ConfigService,
    private usersService: UsersService,
  ) {
    super({
      jwtFromRequest: ExtractJwt.fromExtractors([
        (request) => {
          return request?.cookies?.refreshToken;
        },
      ]),
      ignoreExpiration: false,
      secretOrKey: configService.get('JWT_SECRET'),
    });
  }

  async validate(payload: any) {
    const user = await this.usersService.findOne(payload.sub);
    return user;
  }
}
```

### 5.3 AuthService êµ¬í˜„

**íŒŒì¼**: `src/auth/auth.service.ts`

```typescript
import { Injectable, UnauthorizedException } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { ConfigService } from '@nestjs/config';
import { UsersService } from '../users/users.service';
import axios from 'axios';

@Injectable()
export class AuthService {
  constructor(
    private usersService: UsersService,
    private jwtService: JwtService,
    private configService: ConfigService,
  ) {}

  async kakaoLogin(code: string) {
    // ì¹´ì¹´ì˜¤ í† í° êµí™˜
    const tokenResponse = await axios.post(
      'https://kauth.kakao.com/oauth/token',
      {
        grant_type: 'authorization_code',
        client_id: this.configService.get('KAKAO_REST_API_KEY'),
        redirect_uri: this.configService.get('KAKAO_REDIRECT_URI'),
        code,
      },
      {
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
      },
    );

    const accessToken = tokenResponse.data.access_token;

    // ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
    const userResponse = await axios.get('https://kapi.kakao.com/v2/user/me', {
      headers: {
        Authorization: `Bearer ${accessToken}`,
      },
    });

    const kakaoUser = userResponse.data;
    const kakaoId = kakaoUser.id.toString();

    // DBì—ì„œ ì‚¬ìš©ì ì°¾ê¸° ë˜ëŠ” ìƒì„±
    let user = await this.usersService.findByKakaoId(kakaoId);
    if (!user) {
      user = await this.usersService.create({
        kakaoId,
        nickname: kakaoUser.kakao_account.profile.nickname,
        profileImage: kakaoUser.kakao_account.profile.profile_image_url,
      });
    }

    // JWT í† í° ìƒì„±
    const payload = { sub: user.id, email: user.kakaoId };
    const jwtAccessToken = this.jwtService.sign(payload, {
      expiresIn: this.configService.get('JWT_ACCESS_TOKEN_EXPIRATION'),
    });
    const jwtRefreshToken = this.jwtService.sign(payload, {
      expiresIn: this.configService.get('JWT_REFRESH_TOKEN_EXPIRATION'),
    });

    return {
      user,
      accessToken: jwtAccessToken,
      refreshToken: jwtRefreshToken,
    };
  }

  async refreshToken(refreshToken: string) {
    try {
      const payload = this.jwtService.verify(refreshToken);
      const user = await this.usersService.findOne(payload.sub);

      if (!user) {
        throw new UnauthorizedException();
      }

      const newPayload = { sub: user.id, email: user.kakaoId };
      const newAccessToken = this.jwtService.sign(newPayload, {
        expiresIn: this.configService.get('JWT_ACCESS_TOKEN_EXPIRATION'),
      });

      return {
        accessToken: newAccessToken,
      };
    } catch (error) {
      throw new UnauthorizedException('Invalid refresh token');
    }
  }
}
```

### 5.4 AuthController êµ¬í˜„

**íŒŒì¼**: `src/auth/auth.controller.ts`

```typescript
import {
  Controller,
  Get,
  Post,
  Req,
  Res,
  Query,
  UseGuards,
  HttpCode,
  HttpStatus,
} from '@nestjs/common';
import { Request, Response } from 'express';
import { AuthService } from './auth.service';
import { JwtAuthGuard } from './guards/jwt-auth.guard';
import { ConfigService } from '@nestjs/config';

@Controller('auth')
export class AuthController {
  constructor(
    private authService: AuthService,
    private configService: ConfigService,
  ) {}

  @Get('kakao')
  async kakaoLogin(@Res() res: Response) {
    const kakaoAuthUrl = `https://kauth.kakao.com/oauth/authorize?client_id=${this.configService.get('KAKAO_REST_API_KEY')}&redirect_uri=${this.configService.get('KAKAO_REDIRECT_URI')}&response_type=code`;
    res.redirect(kakaoAuthUrl);
  }

  @Get('kakao/callback')
  async kakaoCallback(@Query('code') code: string, @Res() res: Response) {
    const { user, accessToken, refreshToken } =
      await this.authService.kakaoLogin(code);

    // HttpOnly Cookieì— í† í° ì €ì¥
    res.cookie('accessToken', accessToken, {
      httpOnly: true,
      secure: this.configService.get('NODE_ENV') === 'production',
      sameSite: 'lax',
      maxAge: 15 * 60 * 1000, // 15ë¶„
    });

    res.cookie('refreshToken', refreshToken, {
      httpOnly: true,
      secure: this.configService.get('NODE_ENV') === 'production',
      sameSite: 'lax',
      maxAge: 7 * 24 * 60 * 60 * 1000, // 7ì¼
    });

    // í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    const frontendUrl = this.configService.get('FRONTEND_URL');
    res.redirect(`${frontendUrl}/auth/callback?success=true`);
  }

  @Get('me')
  @UseGuards(JwtAuthGuard)
  async getMe(@Req() req: Request) {
    return req.user;
  }

  @Post('refresh')
  @HttpCode(HttpStatus.OK)
  async refresh(@Req() req: Request, @Res() res: Response) {
    const refreshToken = req.cookies?.refreshToken;
    if (!refreshToken) {
      return res.status(401).json({ message: 'Refresh token not found' });
    }

    const { accessToken } = await this.authService.refreshToken(refreshToken);

    res.cookie('accessToken', accessToken, {
      httpOnly: true,
      secure: this.configService.get('NODE_ENV') === 'production',
      sameSite: 'lax',
      maxAge: 15 * 60 * 1000,
    });

    return res.json({ success: true });
  }

  @Post('logout')
  @HttpCode(HttpStatus.OK)
  async logout(@Res() res: Response) {
    res.clearCookie('accessToken');
    res.clearCookie('refreshToken');
    return res.json({ success: true });
  }
}
```

### 5.5 JWT Auth Guard

**íŒŒì¼**: `src/auth/guards/jwt-auth.guard.ts`

```typescript
import { Injectable, ExecutionContext } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {
  canActivate(context: ExecutionContext) {
    return super.canActivate(context);
  }
}
```

### 5.6 AuthModule ì„¤ì •

**íŒŒì¼**: `src/auth/auth.module.ts`

```typescript
import { Module } from '@nestjs/common';
import { JwtModule } from '@nestjs/jwt';
import { PassportModule } from '@nestjs/passport';
import { ConfigModule, ConfigService } from '@nestjs/config';
import { AuthService } from './auth.service';
import { AuthController } from './auth.controller';
import { JwtStrategy } from './strategies/jwt.strategy';
import { JwtRefreshStrategy } from './strategies/jwt-refresh.strategy';
import { UsersModule } from '../users/users.module';

@Module({
  imports: [
    UsersModule,
    PassportModule,
    JwtModule.registerAsync({
      imports: [ConfigModule],
      useFactory: (configService: ConfigService) => ({
        secret: configService.get('JWT_SECRET'),
        signOptions: {
          expiresIn: configService.get('JWT_ACCESS_TOKEN_EXPIRATION'),
        },
      }),
      inject: [ConfigService],
    }),
  ],
  providers: [AuthService, JwtStrategy, JwtRefreshStrategy],
  controllers: [AuthController],
  exports: [AuthService],
})
export class AuthModule {}
```

---

## 6. API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

### 6.1 Brands API

**íŒŒì¼**: `src/brands/brands.controller.ts`

```typescript
import { Controller, Get, Param } from '@nestjs/common';
import { BrandsService } from './brands.service';

@Controller('brands')
export class BrandsController {
  constructor(private brandsService: BrandsService) {}

  @Get()
  findAll() {
    return this.brandsService.findAll();
  }

  @Get(':slug')
  findOne(@Param('slug') slug: string) {
    return this.brandsService.findOneBySlug(slug);
  }
}
```

### 6.2 MenuItems API

**íŒŒì¼**: `src/menu-items/menu-items.controller.ts`

```typescript
import { Controller, Get, Param, Query } from '@nestjs/common';
import { MenuItemsService } from './menu-items.service';

@Controller('brands/:slug/menu-items')
export class MenuItemsController {
  constructor(private menuItemsService: MenuItemsService) {}

  @Get()
  findAll(
    @Param('slug') slug: string,
    @Query('category') category?: string,
    @Query('sort') sort?: string,
    @Query('page') page?: string,
    @Query('limit') limit?: string,
  ) {
    return this.menuItemsService.findAllByBrandSlug(slug, {
      category,
      sort,
      page: page ? parseInt(page) : 1,
      limit: limit ? parseInt(limit) : 20,
    });
  }
}

@Controller('menu-items')
export class MenuItemsDetailController {
  constructor(private menuItemsService: MenuItemsService) {}

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.menuItemsService.findOne(id);
  }
}
```

### 6.3 Posts API

**íŒŒì¼**: `src/posts/posts.controller.ts`

```typescript
import {
  Controller,
  Get,
  Post,
  Patch,
  Delete,
  Body,
  Param,
  Query,
  UseGuards,
  Req,
} from '@nestjs/common';
import { PostsService } from './posts.service';
import { CreatePostDto } from './dto/create-post.dto';
import { UpdatePostDto } from './dto/update-post.dto';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';

@Controller('posts')
export class PostsController {
  constructor(private postsService: PostsService) {}

  @Get()
  findAll(@Query('page') page?: string, @Query('limit') limit?: string) {
    return this.postsService.findAll({
      page: page ? parseInt(page) : 1,
      limit: limit ? parseInt(limit) : 20,
    });
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.postsService.findOne(id);
  }

  @Post()
  @UseGuards(JwtAuthGuard)
  create(@Body() createPostDto: CreatePostDto, @Req() req: any) {
    return this.postsService.create(createPostDto, req.user.id);
  }

  @Patch(':id')
  @UseGuards(JwtAuthGuard)
  update(
    @Param('id') id: string,
    @Body() updatePostDto: UpdatePostDto,
    @Req() req: any,
  ) {
    return this.postsService.update(id, updatePostDto, req.user.id);
  }

  @Delete(':id')
  @UseGuards(JwtAuthGuard)
  remove(@Param('id') id: string, @Req() req: any) {
    return this.postsService.remove(id, req.user.id);
  }
}
```

### 6.4 Comments API

**íŒŒì¼**: `src/comments/comments.controller.ts`

```typescript
import {
  Controller,
  Get,
  Post,
  Patch,
  Delete,
  Body,
  Param,
  UseGuards,
  Req,
} from '@nestjs/common';
import { CommentsService } from './comments.service';
import { CreateCommentDto } from './dto/create-comment.dto';
import { UpdateCommentDto } from './dto/update-comment.dto';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';

@Controller('posts/:postId/comments')
export class CommentsController {
  constructor(private commentsService: CommentsService) {}

  @Get()
  findAll(@Param('postId') postId: string) {
    return this.commentsService.findAllByPostId(postId);
  }

  @Post()
  @UseGuards(JwtAuthGuard)
  create(
    @Param('postId') postId: string,
    @Body() createCommentDto: CreateCommentDto,
    @Req() req: any,
  ) {
    return this.commentsService.create(postId, createCommentDto, req.user.id);
  }

  @Patch(':id')
  @UseGuards(JwtAuthGuard)
  update(
    @Param('id') id: string,
    @Body() updateCommentDto: UpdateCommentDto,
    @Req() req: any,
  ) {
    return this.commentsService.update(id, updateCommentDto, req.user.id);
  }

  @Delete(':id')
  @UseGuards(JwtAuthGuard)
  remove(@Param('id') id: string, @Req() req: any) {
    return this.commentsService.remove(id, req.user.id);
  }
}
```

---

## 7. ì¹´ì¹´ì˜¤ OAuth ì—°ë™

ì¹´ì¹´ì˜¤ ê°œë°œì ì½˜ì†”ì—ì„œ:

1. ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡
2. í”Œë«í¼ ì„¤ì • (Web í”Œë«í¼ ì¶”ê°€)
3. Redirect URI ë“±ë¡: `http://localhost:3001/auth/kakao/callback`
4. REST API í‚¤ ë° Client Secret ë°œê¸‰

---

## 8. ì¹´ì¹´ì˜¤ ë¡œì»¬ API ì—°ë™

**íŒŒì¼**: `src/stores/stores.service.ts`

```typescript
import { Injectable } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import axios from 'axios';
import { BrandsService } from '../brands/brands.service';

@Injectable()
export class StoresService {
  constructor(
    private configService: ConfigService,
    private brandsService: BrandsService,
  ) {}

  async searchStores(
    brandSlug: string,
    lat: number,
    lng: number,
    radius: number = 5000,
  ) {
    const brand = await this.brandsService.findOneBySlug(brandSlug);
    const keyword = brand.name;

    const response = await axios.get(
      'https://dapi.kakao.com/v2/local/search/keyword.json',
      {
        params: {
          query: keyword,
          x: lng,
          y: lat,
          radius,
        },
        headers: {
          Authorization: `KakaoAK ${this.configService.get('KAKAO_LOCAL_API_KEY')}`,
        },
      },
    );

    return response.data.documents.map((doc: any) => ({
      id: doc.id,
      name: doc.place_name,
      address: doc.address_name,
      roadAddress: doc.road_address_name,
      phone: doc.phone,
      placeUrl: doc.place_url,
      distance: parseInt(doc.distance),
      lat: parseFloat(doc.y),
      lng: parseFloat(doc.x),
    }));
  }
}
```

---

## 9. CORS ë° ë³´ì•ˆ ì„¤ì •

**íŒŒì¼**: `src/main.ts`

```typescript
import { NestFactory } from '@nestjs/core';
import { ValidationPipe } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import * as cookieParser from 'cookie-parser';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  const configService = app.get(ConfigService);

  // CORS ì„¤ì •
  app.enableCors({
    origin: configService.get('FRONTEND_URL'),
    credentials: true,
  });

  // Cookie Parser
  app.use(cookieParser());

  // Validation Pipe
  app.useGlobalPipes(
    new ValidationPipe({
      whitelist: true,
      forbidNonWhitelisted: true,
      transform: true,
    }),
  );

  const port = configService.get('PORT') || 3001;
  await app.listen(port);
  console.log(`Application is running on: http://localhost:${port}`);
}
bootstrap();
```

---

## 10. Render ë°°í¬ ì¤€ë¹„

### 10.1 Render ì„¤ì • íŒŒì¼

**íŒŒì¼**: `render.yaml` (í”„ë¡œì íŠ¸ ë£¨íŠ¸)

```yaml
services:
  - type: web
    name: hamburger-backend
    env: node
    buildCommand: npm install && npm run build
    startCommand: npm run start:prod
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_HOST
        sync: false
      - key: DATABASE_PORT
        value: 5432
      - key: DATABASE_USERNAME
        sync: false
      - key: DATABASE_PASSWORD
        sync: false
      - key: DATABASE_NAME
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: KAKAO_REST_API_KEY
        sync: false
      - key: KAKAO_REDIRECT_URI
        sync: false
      - key: KAKAO_LOCAL_API_KEY
        sync: false
      - key: FRONTEND_URL
        sync: false
```

### 10.2 ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

1. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**
   - Render ëŒ€ì‹œë³´ë“œì—ì„œ ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
   - `DATABASE_HOST`: Render PostgreSQL í˜¸ìŠ¤íŠ¸
   - `KAKAO_REDIRECT_URI`: ë°°í¬ëœ ë°±ì—”ë“œ URLë¡œ ë³€ê²½

2. **PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±**
   - Renderì—ì„œ PostgreSQL ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
   - ì—°ê²° ì •ë³´ë¥¼ í™˜ê²½ ë³€ìˆ˜ì— ì„¤ì •

3. **ë¹Œë“œ ì„¤ì •**
   - Node.js ë²„ì „: 18.x ì´ìƒ
   - Build Command: `npm install && npm run build`
   - Start Command: `npm run start:prod`

4. **ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰**
   - ë°°í¬ í›„ ìˆ˜ë™ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰í•˜ê±°ë‚˜
   - `synchronize: false`ë¡œ ì„¤ì •í•˜ê³  ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±

### 10.3 ì‹œë“œ ë°ì´í„° ìƒì„±

**íŒŒì¼**: `src/database/seeds/brands.seed.ts`

```typescript
import { DataSource } from 'typeorm';
import { Brand } from '../../brands/entities/brand.entity';

export async function seedBrands(dataSource: DataSource) {
  const brandRepository = dataSource.getRepository(Brand);

  const brands = [
    { slug: 'mcdonalds', name: 'ë§¥ë„ë‚ ë“œ' },
    { slug: 'burgerking', name: 'ë²„ê±°í‚¹' },
    { slug: 'lotte', name: 'ë¡¯ë°ë¦¬ì•„' },
    { slug: 'momstouch', name: 'ë§˜ìŠ¤í„°ì¹˜' },
    { slug: 'kfc', name: 'KFC' },
    { slug: 'nobrand', name: 'ë…¸ë¸Œëœë“œë²„ê±°' },
    { slug: 'frank', name: 'í”„ë­í¬ë²„ê±°' },
  ];

  for (const brandData of brands) {
    const existingBrand = await brandRepository.findOne({
      where: { slug: brandData.slug },
    });

    if (!existingBrand) {
      const brand = brandRepository.create(brandData);
      await brandRepository.save(brand);
    }
  }
}
```

---

## ğŸ“ ì¶”ê°€ ì°¸ê³ ì‚¬í•­

### DTO ìƒì„±

ê° ëª¨ë“ˆì— DTOë¥¼ ìƒì„±í•˜ì—¬ Validationì„ ì ìš©í•©ë‹ˆë‹¤:

```typescript
// src/posts/dto/create-post.dto.ts
import { IsString, IsNotEmpty, MinLength } from 'class-validator';

export class CreatePostDto {
  @IsString()
  @IsNotEmpty()
  @MinLength(1)
  title: string;

  @IsString()
  @IsNotEmpty()
  @MinLength(10)
  content: string;
}
```

### ì—ëŸ¬ ì²˜ë¦¬

Global Exception Filterë¥¼ ìƒì„±í•˜ì—¬ ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µì„ ì œê³µí•©ë‹ˆë‹¤.

### ë¡œê¹…

NestJSì˜ ë‚´ì¥ Loggerë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ Winston ë“±ì„ í™œìš©í•©ë‹ˆë‹¤.

---

## 11. í”„ë¡œì íŠ¸ íŒŒì¼ êµ¬ì¡°

### 11.1 ì „ì²´ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
backend/
â”œâ”€â”€ src/                              # ì†ŒìŠ¤ ì½”ë“œ
â”‚   â”œâ”€â”€ app.module.ts                  # ë£¨íŠ¸ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ main.ts                        # ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                          # ì¸ì¦ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ auth.module.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
â”‚   â”‚   â”œâ”€â”€ strategies/                # JWT ì „ëµ
â”‚   â”‚   â”‚   â”œâ”€â”€ jwt.strategy.ts
â”‚   â”‚   â”‚   â””â”€â”€ jwt-refresh.strategy.ts
â”‚   â”‚   â””â”€â”€ guards/                    # ê°€ë“œ
â”‚   â”‚       â””â”€â”€ jwt-auth.guard.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ users/                         # ì‚¬ìš©ì ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ users.module.ts
â”‚   â”‚   â”œâ”€â”€ users.service.ts
â”‚   â”‚   â”œâ”€â”€ users.controller.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ user.entity.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ brands/                        # ë¸Œëœë“œ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ brands.module.ts
â”‚   â”‚   â”œâ”€â”€ brands.service.ts
â”‚   â”‚   â”œâ”€â”€ brands.controller.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ brand.entity.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ menu-items/                    # ë©”ë‰´ ì•„ì´í…œ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ menu-items.module.ts
â”‚   â”‚   â”œâ”€â”€ menu-items.service.ts
â”‚   â”‚   â”œâ”€â”€ menu-items.controller.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ menu-item.entity.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ nutrition/                     # ì˜ì–‘ì •ë³´ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ nutrition.module.ts
â”‚   â”‚   â”œâ”€â”€ nutrition.service.ts
â”‚   â”‚   â””â”€â”€ entities/
â”‚   â”‚       â””â”€â”€ nutrition.entity.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ posts/                         # ê²Œì‹œê¸€ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ posts.module.ts
â”‚   â”‚   â”œâ”€â”€ posts.service.ts
â”‚   â”‚   â”œâ”€â”€ posts.controller.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â””â”€â”€ post.entity.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ create-post.dto.ts
â”‚   â”‚       â””â”€â”€ update-post.dto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ comments/                       # ëŒ“ê¸€ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ comments.module.ts
â”‚   â”‚   â”œâ”€â”€ comments.service.ts
â”‚   â”‚   â”œâ”€â”€ comments.controller.ts
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â””â”€â”€ comment.entity.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚   â”‚       â”œâ”€â”€ create-comment.dto.ts
â”‚   â”‚       â””â”€â”€ update-comment.dto.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                        # ë§¤ì¥ ê²€ìƒ‰ ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ stores.module.ts
â”‚   â”‚   â”œâ”€â”€ stores.service.ts
â”‚   â”‚   â””â”€â”€ stores.controller.ts
â”‚   â”‚
â”‚   â””â”€â”€ admin/                         # ê´€ë¦¬ì ëª¨ë“ˆ (ì˜µì…˜)
â”‚       â”œâ”€â”€ admin.module.ts
â”‚       â”œâ”€â”€ admin.service.ts
â”‚       â”œâ”€â”€ admin.controller.ts
â”‚       â””â”€â”€ entities/
â”‚           â””â”€â”€ ingest-log.entity.ts
â”‚
â”œâ”€â”€ database/                          # ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ init.sql                       # ì´ˆê¸°í™” SQL (DBeaverìš©)
â”‚
â”œâ”€â”€ test/                              # í…ŒìŠ¤íŠ¸ íŒŒì¼
â”‚   â”œâ”€â”€ app.e2e-spec.ts
â”‚   â””â”€â”€ jest-e2e.json
â”‚
â”œâ”€â”€ dist/                              # ë¹Œë“œ ê²°ê³¼ë¬¼ (ìë™ ìƒì„±)
â”‚
â”œâ”€â”€ .env                               # í™˜ê²½ ë³€ìˆ˜ (gitignore)
â”œâ”€â”€ .env.example                       # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì‹œ
â”œâ”€â”€ .gitignore                         # Git ë¬´ì‹œ íŒŒì¼
â”œâ”€â”€ .prettierrc                        # Prettier ì„¤ì •
â”œâ”€â”€ eslint.config.mjs                  # ESLint ì„¤ì •
â”œâ”€â”€ nest-cli.json                      # NestJS CLI ì„¤ì •
â”œâ”€â”€ package.json                       # ì˜ì¡´ì„± ë° ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ tsconfig.json                      # TypeScript ì„¤ì •
â”œâ”€â”€ tsconfig.build.json                # ë¹Œë“œìš© TypeScript ì„¤ì •
â”‚
â”œâ”€â”€ README.md                          # í”„ë¡œì íŠ¸ ê°œìš”
â”œâ”€â”€ INSTALL.md                         # ì„¤ì¹˜ ê°€ì´ë“œ
â”œâ”€â”€ SETUP_GUIDE.md                     # ìƒì„¸ ì„¤ì • ê°€ì´ë“œ (DBeaver í¬í•¨)
â””â”€â”€ ë°±ì—”ë“œ_ì‘ì—…_ê°€ì´ë“œ.md              # ì´ íŒŒì¼
```

### 11.2 ì£¼ìš” íŒŒì¼ ì„¤ëª…

#### ì„¤ì • íŒŒì¼

- **`package.json`**: í”„ë¡œì íŠ¸ ì˜ì¡´ì„± ë° npm ìŠ¤í¬ë¦½íŠ¸
- **`tsconfig.json`**: TypeScript ì»´íŒŒì¼ëŸ¬ ì„¤ì •
- **`.env`**: í™˜ê²½ ë³€ìˆ˜ (ë¡œì»¬ ê°œë°œìš©, gitignore)
- **`.env.example`**: í™˜ê²½ ë³€ìˆ˜ í…œí”Œë¦¿
- **`nest-cli.json`**: NestJS CLI ì„¤ì •

#### ì†ŒìŠ¤ íŒŒì¼

- **`src/main.ts`**: ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì , CORS ë° ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
- **`src/app.module.ts`**: ë£¨íŠ¸ ëª¨ë“ˆ, ëª¨ë“  ëª¨ë“ˆ import

#### ëª¨ë“ˆ êµ¬ì¡°

ê° ëª¨ë“ˆì€ ë‹¤ìŒ êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤:

```
module-name/
â”œâ”€â”€ module-name.module.ts    # ëª¨ë“ˆ ì •ì˜
â”œâ”€â”€ module-name.service.ts   # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”œâ”€â”€ module-name.controller.ts # API ì—”ë“œí¬ì¸íŠ¸
â”œâ”€â”€ entities/                # TypeORM Entity
â”‚   â””â”€â”€ entity-name.entity.ts
â””â”€â”€ dto/                     # Data Transfer Object (ì„ íƒ)
    â”œâ”€â”€ create-entity.dto.ts
    â””â”€â”€ update-entity.dto.ts
```

### 11.3 íŒŒì¼ ìƒì„± ìˆœì„œ

ê°œë°œ ì‹œ ë‹¤ìŒ ìˆœì„œë¡œ íŒŒì¼ì„ ìƒì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤:

1. **Entity ìƒì„±** (`entities/*.entity.ts`)
2. **Module ìƒì„±** (`*.module.ts`)
3. **Service ìƒì„±** (`*.service.ts`)
4. **Controller ìƒì„±** (`*.controller.ts`)
5. **DTO ìƒì„±** (`dto/*.dto.ts`) - í•„ìš”í•œ ê²½ìš°

### 11.4 ëª…ë ¹ì–´ë¡œ ëª¨ë“ˆ ìƒì„±

NestJS CLIë¥¼ ì‚¬ìš©í•˜ì—¬ ìë™ ìƒì„±:

```bash
# ëª¨ë“ˆ ìƒì„±
nest g module users
nest g module brands
nest g module menu-items

# Service ë° Controller ìƒì„±
nest g service users
nest g controller users

# Entity ìƒì„± (ìˆ˜ë™)
nest g class users/entities/user.entity --no-spec
```

---

## ğŸ“ ì¶”ê°€ ì°¸ê³ ì‚¬í•­

### DTO ìƒì„±

ê° ëª¨ë“ˆì— DTOë¥¼ ìƒì„±í•˜ì—¬ Validationì„ ì ìš©í•©ë‹ˆë‹¤:

```typescript
// src/posts/dto/create-post.dto.ts
import { IsString, IsNotEmpty, MinLength } from 'class-validator';

export class CreatePostDto {
  @IsString()
  @IsNotEmpty()
  @MinLength(1)
  title: string;

  @IsString()
  @IsNotEmpty()
  @MinLength(10)
  content: string;
}
```

### ì—ëŸ¬ ì²˜ë¦¬

Global Exception Filterë¥¼ ìƒì„±í•˜ì—¬ ì¼ê´€ëœ ì—ëŸ¬ ì‘ë‹µì„ ì œê³µí•©ë‹ˆë‹¤.

### ë¡œê¹…

NestJSì˜ ë‚´ì¥ Loggerë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ Winston ë“±ì„ í™œìš©í•©ë‹ˆë‹¤.

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘ ì²´í¬ë¦¬ìŠ¤íŠ¸

1. âœ… Node.js ë° PostgreSQL ì„¤ì¹˜ í™•ì¸
2. âœ… `npm install` ì‹¤í–‰
3. âœ… DBeaverë¡œ PostgreSQL ì—°ê²°
4. âœ… `hamburger_collection` ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
5. âœ… `database/init.sql` ì‹¤í–‰
6. âœ… `.env` íŒŒì¼ ìƒì„± ë° ì„¤ì •
7. âœ… `npm run start:dev` ì‹¤í–‰
8. âœ… API í…ŒìŠ¤íŠ¸ (`http://localhost:3001/brands`)

---

ì´ ê°€ì´ë“œë¥¼ ë”°ë¼ ë‹¨ê³„ì ìœ¼ë¡œ ë°±ì—”ë“œë¥¼ êµ¬ì¶•í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ê° ë‹¨ê³„ë§ˆë‹¤ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©° ë¬¸ì œê°€ ë°œìƒí•˜ë©´ í•´ê²° í›„ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•˜ì„¸ìš”.

**ì¶”ê°€ ë„ì›€ë§:**

- ì´ˆê¸° ì„¤ì •: [SETUP_GUIDE.md](./SETUP_GUIDE.md) ì°¸ê³ 
- ì„¤ì¹˜ ê°€ì´ë“œ: [INSTALL.md](./INSTALL.md) ì°¸ê³ 
